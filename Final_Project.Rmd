---
title: "Analysis of salaries of data scientists"
author: "Group 12"
date: "December 1st, 2024"
output: pdf_document
---

-   Egbo Joseph (143037470)
-   Goudy Joshua (169031329)
-   Thambiaiah Melissa (169060509)
-   Umar Emaan (169108097)

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
library(scatterplot3d)
library(corrr)
library(kableExtra)
library(ggridges)
```

```{r import}
grapes_0<-read_csv('GRAPE_QUALITY.csv')
```

```{r data_cleaning}
grapes<-grapes_0|>
  select(!(sample_id))
grapes$quality_category<-factor(grapes$quality_category, levels = c('Low', 'Medium', 'High', 'Premium'))
grapes<-grapes|>
  mutate(wine_type = case_when(
        variety == 'Riesling' ~ 'White',
        variety == 'Pinot Noir' ~ 'Red',
        variety == 'Sauvignon Blanc'~'White',
        variety == 'Merlot'~'Red',
        variety == 'Zinfandel'~'Red',
        variety == 'Chardonnay'~'White',
        variety == 'Syrah'~'Red',
        variety == 'Cabernet Sauvignon'~'Red',
        .default = variety
      ),
      harvest_week = as.integer(week(harvest_date)) - 30
      )
```

```{r}
grapes_split <- initial_validation_split(grapes, prop = c(0.6, 0.2))

set.seed(1000)

grapes_train <- training(grapes_split)
grapes_valid <- validation(grapes_split)
grapes_test <- testing(grapes_split)

```

```{r}
percentile_by_region<-grapes|>
  group_by(region)|>
  mutate(r_count = n())|>
  group_by(region, quality_category)|>
  mutate(count = n(),
         percent = (count/r_count) * 100,
         percent = round(percent, 1))|>
  select(region, quality_category, percent)|>
  unique()|>
  arrange(region, quality_category)|>
  pivot_wider(names_from = quality_category, values_from = percent)
```


```{r}
generate_correlation_table <- function(data) {
  continuous_vars <- data %>% select_if(is.numeric)
  correlation_matrix <- cor(continuous_vars, use = "complete.obs") 
  correlation_table <- as.data.frame(correlation_matrix) 
  return(correlation_table) }

grapes_woqs<-grapes_train|>
  select(!(quality_score))

round_table <- function(data, digits = 1) { data %>% mutate(across(everything(), ~ round(.x, digits))) }
corrs <- generate_correlation_table(grapes_woqs)
corrs <- round_table(corrs, 4)

kable(corrs)|>kable_styling()|>
  column_spec(1, width = '30em', background = 'palevioletred')|>
  column_spec(c(2,4,6, 8), width = "30em", background = "aquamarine")|>
  column_spec(c(3,5,7,9), width = '30em', background = 'rosybrown1')|>
  row_spec(0, background = 'palevioletred')

```




# Exploratory Plot 1/Table 1 (only using 2 or more features, not the target variable)

```{r}
ggplot(grapes, mapping = aes(y = sugar_content_brix, x = berry_size_mm))+
  geom_point()
```

```{r}
if (interactive()) {
    library(rgl) # need install.packages("rgl"), still might fail
    plot3d(x = grapes$sugar_content_brix, y = grapes$sun_exposure_hours, z = grapes$quality_score)
    }
```
